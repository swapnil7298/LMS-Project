{% if session.role == 'student' %}
<div class="submission-area">
    
    {% if assignment.submission %}
        <div class="submission-status-header">
            <strong>Your Submission:</strong>
            <a href="{{ url_for('view_submission_file', filename=assignment.submission.filename) }}" target="_blank" class="btn btn-info btn-sm">
                <i class="fas fa-eye"></i> View File
            </a>
        </div>

        {% if assignment.can_edit %}
            <p class="text-muted mt-2">You can replace your submission until the due date.</p>
            <form action="{{ url_for('resubmit_assignment', submission_id=assignment.submission._id) }}" method="POST" enctype="multipart/form-data" class="submission-form">
                <input type="file" class="form-control" name="submission_file" required>
                <button type="submit" class="btn btn-warning"><i class="fas fa-upload"></i> Replace</button>
            </form>
        {% else %}
            {% if assignment.submission.grade %}
                <div class="alert alert-success mt-2">
                    <strong>Status:</strong> Graded (Score: {{ assignment.submission.grade }})
                </div>
                {% if assignment.submission.feedback %}
                <div class="feedback-box">
                    <strong>Teacher's Feedback:</strong>
                    <p class="fst-italic mb-0">"{{ assignment.submission.feedback }}"</p>
                </div>
                {% endif %}
            {% else %}
                <div class="alert alert-secondary mt-2">
                    <strong>Status:</strong> Past Due Date. Submission is locked.
                </div>
            {% endif %}
        {% endif %}

    {% else %}
        {% if assignment.is_submittable %}
            <p><strong>Submit your work:</strong></p>
            <form action="{{ url_for('submit_assignment', assignment_id=assignment._id) }}" method="POST" enctype="multipart/form-data" class="submission-form">
                <input type="file" class="form-control" name="submission_file" required>
                <button type="submit" class="btn btn-primary"><i class="fas fa-upload"></i> Submit</button>
            </form>
        {% else %}
            <div class="alert alert-danger p-2">
                The due date for this assignment has passed. Submissions are closed.
            </div>
        {% endif %}
    {% endif %}
</div>
{% endif %}

{% if session.role in ['teacher', 'admin'] %}
<div class="teacher-submission-link">
    <a href="{{ url_for('view_submissions', assignment_id=assignment._id) }}">
        View Submissions ({{ assignment.submission_count }})
    </a>
</div>
{% endif %}